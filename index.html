<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>·ª®ng d·ª•ng T√≠nh to√°n Ch·ªâ s·ªë Kho h√†ng</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            background: transparent;
            font-size: 1.1em;
            font-weight: 600;
        }

        .tab.active {
            background: white;
            color: #3498db;
            border-bottom: 3px solid #3498db;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .upload-area {
            border: 3px dashed #3498db;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
            background: #f8f9ff;
            transition: all 0.3s ease;
        }

        .upload-area:hover {
            border-color: #2980b9;
            background: #e8f4f8;
        }

        .upload-area.drag-over {
            border-color: #27ae60;
            background: #e8f8f5;
        }

        .file-input {
            display: none;
        }

        .upload-btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 0.9em;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .data-table th {
            background: linear-gradient(135deg, #34495e, #2c3e50);
            color: white;
            padding: 15px 12px;
            text-align: left;
            font-weight: 600;
        }

        .data-table td {
            padding: 12px;
            border-bottom: 1px solid #dee2e6;
            transition: background 0.3s ease;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        .data-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .metric-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border-left: 5px solid #3498db;
            transition: all 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        }

        .metric-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .metric-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 10px;
        }

        .metric-description {
            color: #7f8c8d;
            line-height: 1.5;
        }

        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            margin: 20px 0;
        }

        .export-btn {
            background: linear-gradient(135deg, #27ae60, #219a52);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.3);
        }

        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            font-weight: 600;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .inventory-analysis {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .analysis-section {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .analysis-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3em;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        .abc-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .abc-item:hover {
            background: #f8f9fa;
        }

        .abc-a { border-left: 4px solid #e74c3c; }
        .abc-b { border-left: 4px solid #f39c12; }
        .abc-c { border-left: 4px solid #27ae60; }

        .loading {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }
            
            .inventory-analysis {
                grid-template-columns: 1fr;
            }
            
            .metrics-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè≠ ·ª®ng d·ª•ng T√≠nh to√°n Ch·ªâ s·ªë Kho h√†ng</h1>
            <p>Ph√¢n t√≠ch hi·ªáu qu·∫£ qu·∫£n l√Ω kho h√†ng v·ªõi c√°c ch·ªâ s·ªë chuy√™n nghi·ªáp</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('upload')">üìÅ Upload D·ªØ li·ªáu</button>
            <button class="tab" onclick="switchTab('analysis')">üìä Ph√¢n t√≠ch</button>
            <button class="tab" onclick="switchTab('charts')">üìà Bi·ªÉu ƒë·ªì</button>
            <button class="tab" onclick="switchTab('export')">üíæ Xu·∫•t b√°o c√°o</button>
        </div>

        <div id="upload" class="tab-content active">
            <div class="upload-area" id="uploadArea">
                <h3>üìÇ T·∫£i l√™n d·ªØ li·ªáu nh·∫≠p xu·∫•t kho</h3>
                <p>K√©o th·∫£ file Excel/CSV v√†o ƒë√¢y ho·∫∑c click ƒë·ªÉ ch·ªçn file</p>
                <input type="file" id="fileInput" class="file-input" accept=".xlsx,.xls,.csv" onchange="handleFileUpload(event)">
                <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
                    Ch·ªçn file
                </button>
            </div>

            <div id="dataPreview" style="display: none;">
                <h3>üëÄ Xem tr∆∞·ªõc d·ªØ li·ªáu</h3>
                <div style="overflow-x: auto;">
                    <table id="previewTable" class="data-table">
                        <thead id="previewHeader"></thead>
                        <tbody id="previewBody"></tbody>
                    </table>
                </div>
                <button class="upload-btn" onclick="processData()">
                    üîÑ X·ª≠ l√Ω d·ªØ li·ªáu
                </button>
            </div>

            <div id="status"></div>
        </div>

        <div id="analysis" class="tab-content">
            <div class="metrics-grid" id="metricsGrid">
                <!-- Metrics s·∫Ω ƒë∆∞·ª£c t·∫°o ƒë·ªông -->
            </div>

            <div class="inventory-analysis">
                <div class="analysis-section">
                    <h3>üìä Ph√¢n t√≠ch ABC</h3>
                    <div id="abcAnalysis"></div>
                </div>
                
                <div class="analysis-section">
                    <h3>‚ö†Ô∏è C·∫£nh b√°o t·ªìn kho</h3>
                    <div id="stockAlerts"></div>
                </div>
            </div>
        </div>

        <div id="charts" class="tab-content">
            <div class="chart-container">
                <h3>üìà Bi·ªÉu ƒë·ªì v√≤ng quay h√†ng t·ªìn kho</h3>
                <canvas id="turnoverChart"></canvas>
            </div>
            
            <div class="chart-container">
                <h3>üìä Bi·ªÉu ƒë·ªì ph√¢n t√≠ch ABC</h3>
                <canvas id="abcChart"></canvas>
            </div>
        </div>

        <div id="export" class="tab-content">
            <h3>üíæ Xu·∫•t b√°o c√°o</h3>
            <p>T·∫£i xu·ªëng b√°o c√°o ph√¢n t√≠ch kho h√†ng d∆∞·ªõi c√°c ƒë·ªãnh d·∫°ng kh√°c nhau</p>
            
            <div style="margin: 20px 0;">
                <button class="export-btn" onclick="exportToCSV()">
                    üìÑ Xu·∫•t CSV
                </button>
                <button class="export-btn" onclick="exportToJSON()">
                    üìã Xu·∫•t JSON
                </button>
                <button class="export-btn" onclick="printReport()">
                    üñ®Ô∏è In b√°o c√°o
                </button>
            </div>

            <div id="exportPreview" class="analysis-section">
                <h3>üìã Xem tr∆∞·ªõc b√°o c√°o</h3>
                <div id="reportContent"></div>
            </div>
        </div>
    </div>

    <script>
        let inventoryData = [];
        let processedData = {};
        let charts = {};

        // Kh·ªüi t·∫°o ·ª©ng d·ª•ng
        document.addEventListener('DOMContentLoaded', function() {
            setupDragAndDrop();
        });

        // Chuy·ªÉn tab
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        // Thi·∫øt l·∫≠p drag and drop
        function setupDragAndDrop() {
            const uploadArea = document.getElementById('uploadArea');
            
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('drag-over');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('drag-over');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('drag-over');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFileUpload({ target: { files: files } });
                }
            });
        }

        // X·ª≠ l√Ω upload file
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const status = document.getElementById('status');
            status.innerHTML = '<div class="status loading">ƒêang t·∫£i file...</div>';

            const reader = new FileReader();
            reader.onload = function(e) {
                const data = e.target.result;
                
                if (file.name.endsWith('.csv')) {
                    parseCSV(data);
                } else {
                    status.innerHTML = '<div class="status error">Hi·ªán t·∫°i ch·ªâ h·ªó tr·ª£ file CSV. Vui l√≤ng chuy·ªÉn ƒë·ªïi Excel sang CSV.</div>';
                }
            };
            reader.readAsText(file);
        }

        // Parse CSV
        function parseCSV(csvData) {
            Papa.parse(csvData, {
                header: true,
                skipEmptyLines: true,
                dynamicTyping: true,
                complete: function(results) {
                    inventoryData = results.data;
                    displayPreview();
                    document.getElementById('status').innerHTML = 
                        `<div class="status success">‚úÖ ƒê√£ t·∫£i th√†nh c√¥ng ${inventoryData.length} d√≤ng d·ªØ li·ªáu</div>`;
                },
                error: function(error) {
                    document.getElementById('status').innerHTML = 
                        `<div class="status error">‚ùå L·ªói khi ƒë·ªçc file: ${error.message}</div>`;
                }
            });
        }

        // Hi·ªÉn th·ªã preview
        function displayPreview() {
            const preview = document.getElementById('dataPreview');
            const table = document.getElementById('previewTable');
            const header = document.getElementById('previewHeader');
            const body = document.getElementById('previewBody');

            if (inventoryData.length === 0) return;

            // T·∫°o header
            const headers = Object.keys(inventoryData[0]);
            header.innerHTML = '<tr>' + headers.map(h => `<th>${h}</th>`).join('') + '</tr>';

            // T·∫°o body (ch·ªâ hi·ªÉn th·ªã 10 d√≤ng ƒë·∫ßu)
            const previewRows = inventoryData.slice(0, 10);
            body.innerHTML = previewRows.map(row => 
                '<tr>' + headers.map(h => `<td>${row[h] || ''}</td>`).join('') + '</tr>'
            ).join('');

            preview.style.display = 'block';
        }

        // X·ª≠ l√Ω d·ªØ li·ªáu
        function processData() {
            if (inventoryData.length === 0) {
                alert('Vui l√≤ng t·∫£i l√™n d·ªØ li·ªáu tr∆∞·ªõc!');
                return;
            }

            const status = document.getElementById('status');
            status.innerHTML = '<div class="status loading">ƒêang ph√¢n t√≠ch d·ªØ li·ªáu...</div>';

            try {
                calculateMetrics();
                generateCharts();
                updateReportPreview();
                
                status.innerHTML = '<div class="status success">‚úÖ Ph√¢n t√≠ch ho√†n t·∫•t! Chuy·ªÉn sang tab "Ph√¢n t√≠ch" ƒë·ªÉ xem k·∫øt qu·∫£.</div>';
                
                // T·ª± ƒë·ªông chuy·ªÉn sang tab ph√¢n t√≠ch
                setTimeout(() => switchTab('analysis'), 1000);
            } catch (error) {
                status.innerHTML = `<div class="status error">‚ùå L·ªói khi ph√¢n t√≠ch: ${error.message}</div>`;
            }
        }

        // T√≠nh to√°n c√°c ch·ªâ s·ªë
        function calculateMetrics() {
            const itemStats = {};
            let totalRevenue = 0;
            let totalCost = 0;

            // X·ª≠ l√Ω d·ªØ li·ªáu theo t·ª´ng s·∫£n ph·∫©m
            inventoryData.forEach(row => {
                const itemCode = row['m√£ h√†ng'] || row['M√£ h√†ng'] || row['ma_hang'];
                const quantity = parseFloat(row['s·ªë l∆∞·ª£ng'] || row['S·ªë l∆∞·ª£ng'] || row['so_luong']) || 0;
                const value = parseFloat(row['gi√° tr·ªã nh·∫≠p xu·∫•t'] || row['Gi√° tr·ªã nh·∫≠p xu·∫•t'] || row['gia_tri']) || 0;
                const type = row['lo·∫°i phi·∫øu'] || row['Lo·∫°i phi·∫øu'] || row['loai_phieu'];
                
                if (!itemCode) return;

                if (!itemStats[itemCode]) {
                    itemStats[itemCode] = {
                        totalIn: 0,
                        totalOut: 0,
                        valueIn: 0,
                        valueOut: 0,
                        transactions: 0
                    };
                }

                itemStats[itemCode].transactions++;

                if (type && type.toLowerCase().includes('nh·∫≠p')) {
                    itemStats[itemCode].totalIn += quantity;
                    itemStats[itemCode].valueIn += value;
                } else if (type && type.toLowerCase().includes('xu·∫•t')) {
                    itemStats[itemCode].totalOut += quantity;
                    itemStats[itemCode].valueOut += value;
                }

                totalRevenue += value;
                if (value > 0) totalCost += value * 0.7; // Gi·∫£ ƒë·ªãnh cost = 70% revenue
            });

            // T√≠nh to√°n c√°c ch·ªâ s·ªë
            const metrics = {
                totalItems: Object.keys(itemStats).length,
                totalTransactions: inventoryData.length,
                totalRevenue: totalRevenue,
                averageInventoryValue: totalRevenue / 12, // Gi·∫£ ƒë·ªãnh 12 th√°ng
                inventoryTurnover: totalCost / (totalRevenue / 12),
                daysInInventory: 365 / (totalCost / (totalRevenue / 12)),
                stockoutRate: calculateStockoutRate(itemStats),
                abcAnalysis: performABCAnalysis(itemStats)
            };

            processedData = { itemStats, metrics };
            displayMetrics(metrics);
        }

        // T√≠nh t·ª∑ l·ªá h·∫øt h√†ng
        function calculateStockoutRate(itemStats) {
            let stockoutItems = 0;
            const totalItems = Object.keys(itemStats).length;

            Object.values(itemStats).forEach(item => {
                const currentStock = item.totalIn - item.totalOut;
                if (currentStock <= 0) stockoutItems++;
            });

            return totalItems > 0 ? (stockoutItems / totalItems * 100).toFixed(2) : 0;
        }

        // Ph√¢n t√≠ch ABC
        function performABCAnalysis(itemStats) {
            const items = Object.entries(itemStats).map(([code, stats]) => ({
                code,
                value: stats.valueOut,
                percentage: 0
            }));

            const totalValue = items.reduce((sum, item) => sum + item.value, 0);
            items.forEach(item => {
                item.percentage = totalValue > 0 ? (item.value / totalValue * 100) : 0;
            });

            items.sort((a, b) => b.value - a.value);

            let cumulativePercentage = 0;
            return items.map(item => {
                cumulativePercentage += item.percentage;
                let category = 'C';
                if (cumulativePercentage <= 80) category = 'A';
                else if (cumulativePercentage <= 95) category = 'B';

                return { ...item, category, cumulativePercentage };
            });
        }

        // Hi·ªÉn th·ªã metrics
        function displayMetrics(metrics) {
            const grid = document.getElementById('metricsGrid');
            
            const metricCards = [
                {
                    title: 'T·ªïng s·ªë m·∫∑t h√†ng',
                    value: metrics.totalItems,
                    description: 'S·ªë l∆∞·ª£ng s·∫£n ph·∫©m kh√°c nhau trong kho'
                },
                {
                    title: 'V√≤ng quay h√†ng t·ªìn kho',
                    value: metrics.inventoryTurnover.toFixed(2),
                    description: 'S·ªë l·∫ßn b√°n h·∫øt h√†ng t·ªìn kho trong nƒÉm'
                },
                {
                    title: 'S·ªë ng√†y t·ªìn kho',
                    value: Math.round(metrics.daysInInventory),
                    description: 'Th·ªùi gian trung b√¨nh ƒë·ªÉ b√°n h·∫øt h√†ng t·ªìn kho'
                },
                {
                    title: 'T·ª∑ l·ªá h·∫øt h√†ng (%)',
                    value: metrics.stockoutRate + '%',
                    description: 'T·ª∑ l·ªá s·∫£n ph·∫©m b·ªã h·∫øt h√†ng'
                },
                {
                    title: 'T·ªïng giao d·ªãch',
                    value: metrics.totalTransactions,
                    description: 'T·ªïng s·ªë phi·∫øu nh·∫≠p/xu·∫•t trong k·ª≥'
                },
                {
                    title: 'Gi√° tr·ªã h√†ng t·ªìn kho TB',
                    value: new Intl.NumberFormat('vi-VN').format(Math.round(metrics.averageInventoryValue)),
                    description: 'Gi√° tr·ªã trung b√¨nh h√†ng t·ªìn kho'
                }
            ];

            grid.innerHTML = metricCards.map(metric => `
                <div class="metric-card">
                    <h3>${metric.title}</h3>
                    <div class="metric-value">${metric.value}</div>
                    <div class="metric-description">${metric.description}</div>
                </div>
            `).join('');

            // Hi·ªÉn th·ªã ABC Analysis
            displayABCAnalysis(metrics.abcAnalysis);
            displayStockAlerts();
        }

        // Hi·ªÉn th·ªã ABC Analysis
        function displayABCAnalysis(abcData) {
            const container = document.getElementById('abcAnalysis');
            const categories = { A: [], B: [], C: [] };
            
            abcData.forEach(item => {
                categories[item.category].push(item);
            });

            let html = '';
            Object.entries(categories).forEach(([category, items]) => {
                html += `<h4>Nh√≥m ${category} (${items.length} s·∫£n ph·∫©m)</h4>`;
                items.slice(0, 5).forEach(item => {
                    html += `
                        <div class="abc-item abc-${category.toLowerCase()}">
                            <span>${item.code}</span>
                            <span>${item.percentage.toFixed(1)}%</span>
                        </div>
                    `;
                });
            });

            container.innerHTML = html;
        }

        // Hi·ªÉn th·ªã c·∫£nh b√°o t·ªìn kho
        function displayStockAlerts() {
            const container = document.getElementById('stockAlerts');
            const itemStats = processedData.itemStats;
            
            let alerts = [];
            Object.entries(itemStats).forEach(([code, stats]) => {
                const currentStock = stats.totalIn - stats.totalOut;
                if (currentStock <= 0) {
                    alerts.push({ code, stock: currentStock, type: 'danger' });
                } else if (currentStock <= 10) {
                    alerts.push({ code, stock: currentStock, type: 'warning' });
                }
            });

            if (alerts.length === 0) {
                container.innerHTML = '<p style="color: #27ae60;">‚úÖ Kh√¥ng c√≥ c·∫£nh b√°o t·ªìn kho</p>';
            } else {
                container.innerHTML = alerts.map(alert => `
                    <div class="abc-item" style="border-left-color: ${alert.type === 'danger' ? '#e74c3c' : '#f39c12'}">
                        <span>${alert.code}</span>
                        <span style="color: ${alert.type === 'danger' ? '#e74c3c' : '#f39c12'}">
                            ${alert.stock <= 0 ? 'H·∫øt h√†ng' : `C√≤n ${alert.stock}`}
                        </span>
                    </div>
                `).join('');
            }
        }

        // T·∫°o bi·ªÉu ƒë·ªì
        function generateCharts() {
            generateTurnoverChart();
            generateABCChart();
        }

        // Bi·ªÉu ƒë·ªì v√≤ng quay
        function generateTurnoverChart() {
            const ctx = document.getElementById('turnoverChart').getContext('2d');
            
            if (charts.turnover) {
                charts.turnover.destroy();
            }

            const itemStats = processedData.itemStats;
            const items = Object.entries(itemStats)
                .map(([code, stats]) => ({
                    code,
                    turnover: stats.valueOut / (stats.valueIn || 1)
                }))
                .sort((a, b) => b.turnover - a.turnover)
                .slice(0, 10);

            charts.turnover = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: items.map(item => item.code),
                    datasets: [{
                        label: 'V√≤ng quay h√†ng t·ªìn kho',
                        data: items.map(item => item.turnover),
                        backgroundColor: 'rgba(52, 152, 219, 0.8)',
                        borderColor: 'rgba(52, 152, 219, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Bi·ªÉu ƒë·ªì ABC
        function generateABCChart() {
            const ctx = document.getElementById('abcChart').getContext('2d');
            
            if (charts.abc) {
                charts.abc.destroy();
            }

            const abcData = processedData.metrics.abcAnalysis;
            const categories = { A: 0, B: 0, C: 0 };
            
            abcData.forEach(item => {
                categories[item.category]++;
            });

            charts.abc = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Nh√≥m A', 'Nh√≥m B', 'Nh√≥m C'],
                    datasets: [{
                        data: [categories.A, categories.B, categories.C],
                        backgroundColor: ['#e74c3c', '#f39c12', '#27ae60'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // C·∫≠p nh·∫≠t preview b√°o c√°o
        function updateReportPreview() {
            const container = document.getElementById('reportContent');
            const metrics = processedData.metrics;
            
            container.innerHTML = `
